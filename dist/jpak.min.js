!function(definition){if("function"==typeof bootstrap)bootstrap("promise",definition);else if("object"==typeof exports)module.exports=definition();else if("function"==typeof define&&define.amd)define(definition);else if("undefined"!=typeof ses){if(!ses.ok())return;ses.makeQ=definition}else Q=definition()}(function(){"use strict";function uncurryThis(f){return function(){return call.apply(f,arguments)}}function isObject(value){return value===Object(value)}function isStopIteration(exception){return"[object StopIteration]"===object_toString(exception)||exception instanceof QReturnValue}function makeStackTraceLong(error,promise){if(hasStacks&&promise.stack&&"object"==typeof error&&null!==error&&error.stack&&-1===error.stack.indexOf(STACK_JUMP_SEPARATOR)){for(var stacks=[],p=promise;p;p=p.source)p.stack&&stacks.unshift(p.stack);stacks.unshift(error.stack);var concatedStacks=stacks.join("\n"+STACK_JUMP_SEPARATOR+"\n");error.stack=filterStackString(concatedStacks)}}function filterStackString(stackString){for(var lines=stackString.split("\n"),desiredLines=[],i=0;i<lines.length;++i){var line=lines[i];isInternalFrame(line)||isNodeFrame(line)||!line||desiredLines.push(line)}return desiredLines.join("\n")}function isNodeFrame(stackLine){return-1!==stackLine.indexOf("(module.js:")||-1!==stackLine.indexOf("(node.js:")}function getFileNameAndLineNumber(stackLine){var attempt1=/at .+ \((.+):(\d+):(?:\d+)\)$/.exec(stackLine);if(attempt1)return[attempt1[1],Number(attempt1[2])];var attempt2=/at ([^ ]+):(\d+):(?:\d+)$/.exec(stackLine);if(attempt2)return[attempt2[1],Number(attempt2[2])];var attempt3=/.*@(.+):(\d+)$/.exec(stackLine);return attempt3?[attempt3[1],Number(attempt3[2])]:void 0}function isInternalFrame(stackLine){var fileNameAndLineNumber=getFileNameAndLineNumber(stackLine);if(!fileNameAndLineNumber)return!1;var fileName=fileNameAndLineNumber[0],lineNumber=fileNameAndLineNumber[1];return fileName===qFileName&&lineNumber>=qStartingLine&&qEndingLine>=lineNumber}function captureLine(){if(hasStacks)try{throw new Error}catch(e){var lines=e.stack.split("\n"),firstLine=lines[0].indexOf("@")>0?lines[1]:lines[2],fileNameAndLineNumber=getFileNameAndLineNumber(firstLine);if(!fileNameAndLineNumber)return;return qFileName=fileNameAndLineNumber[0],fileNameAndLineNumber[1]}}function deprecate(callback,name,alternative){return function(){return"undefined"!=typeof console&&"function"==typeof console.warn&&console.warn(name+" is deprecated, use "+alternative+" instead.",new Error("").stack),callback.apply(callback,arguments)}}function Q(value){return isPromise(value)?value:isPromiseAlike(value)?coerce(value):fulfill(value)}function defer(){function become(newPromise){resolvedPromise=newPromise,promise.source=newPromise,array_reduce(messages,function(undefined,message){nextTick(function(){newPromise.promiseDispatch.apply(newPromise,message)})},void 0),messages=void 0,progressListeners=void 0}var resolvedPromise,messages=[],progressListeners=[],deferred=object_create(defer.prototype),promise=object_create(Promise.prototype);if(promise.promiseDispatch=function(resolve,op,operands){var args=array_slice(arguments);messages?(messages.push(args),"when"===op&&operands[1]&&progressListeners.push(operands[1])):nextTick(function(){resolvedPromise.promiseDispatch.apply(resolvedPromise,args)})},promise.valueOf=function(){if(messages)return promise;var nearerValue=nearer(resolvedPromise);return isPromise(nearerValue)&&(resolvedPromise=nearerValue),nearerValue},promise.inspect=function(){return resolvedPromise?resolvedPromise.inspect():{state:"pending"}},Q.longStackSupport&&hasStacks)try{throw new Error}catch(e){promise.stack=e.stack.substring(e.stack.indexOf("\n")+1)}return deferred.promise=promise,deferred.resolve=function(value){resolvedPromise||become(Q(value))},deferred.fulfill=function(value){resolvedPromise||become(fulfill(value))},deferred.reject=function(reason){resolvedPromise||become(reject(reason))},deferred.notify=function(progress){resolvedPromise||array_reduce(progressListeners,function(undefined,progressListener){nextTick(function(){progressListener(progress)})},void 0)},deferred}function promise(resolver){if("function"!=typeof resolver)throw new TypeError("resolver must be a function.");var deferred=defer();try{resolver(deferred.resolve,deferred.reject,deferred.notify)}catch(reason){deferred.reject(reason)}return deferred.promise}function race(answerPs){return promise(function(resolve,reject){for(var i=0,len=answerPs.length;len>i;i++)Q(answerPs[i]).then(resolve,reject)})}function Promise(descriptor,fallback,inspect){void 0===fallback&&(fallback=function(op){return reject(new Error("Promise does not support operation: "+op))}),void 0===inspect&&(inspect=function(){return{state:"unknown"}});var promise=object_create(Promise.prototype);if(promise.promiseDispatch=function(resolve,op,args){var result;try{result=descriptor[op]?descriptor[op].apply(promise,args):fallback.call(promise,op,args)}catch(exception){result=reject(exception)}resolve&&resolve(result)},promise.inspect=inspect,inspect){var inspected=inspect();"rejected"===inspected.state&&(promise.exception=inspected.reason),promise.valueOf=function(){var inspected=inspect();return"pending"===inspected.state||"rejected"===inspected.state?promise:inspected.value}}return promise}function when(value,fulfilled,rejected,progressed){return Q(value).then(fulfilled,rejected,progressed)}function nearer(value){if(isPromise(value)){var inspected=value.inspect();if("fulfilled"===inspected.state)return inspected.value}return value}function isPromise(object){return isObject(object)&&"function"==typeof object.promiseDispatch&&"function"==typeof object.inspect}function isPromiseAlike(object){return isObject(object)&&"function"==typeof object.then}function isPending(object){return isPromise(object)&&"pending"===object.inspect().state}function isFulfilled(object){return!isPromise(object)||"fulfilled"===object.inspect().state}function isRejected(object){return isPromise(object)&&"rejected"===object.inspect().state}function resetUnhandledRejections(){unhandledReasons.length=0,unhandledRejections.length=0,trackUnhandledRejections||(trackUnhandledRejections=!0)}function trackRejection(promise,reason){trackUnhandledRejections&&(unhandledRejections.push(promise),reason&&"undefined"!=typeof reason.stack?unhandledReasons.push(reason.stack):unhandledReasons.push("(no stack) "+reason))}function untrackRejection(promise){if(trackUnhandledRejections){var at=array_indexOf(unhandledRejections,promise);-1!==at&&(unhandledRejections.splice(at,1),unhandledReasons.splice(at,1))}}function reject(reason){var rejection=Promise({when:function(rejected){return rejected&&untrackRejection(this),rejected?rejected(reason):this}},function(){return this},function(){return{state:"rejected",reason:reason}});return trackRejection(rejection,reason),rejection}function fulfill(value){return Promise({when:function(){return value},get:function(name){return value[name]},set:function(name,rhs){value[name]=rhs},"delete":function(name){delete value[name]},post:function(name,args){return null===name||void 0===name?value.apply(void 0,args):value[name].apply(value,args)},apply:function(thisp,args){return value.apply(thisp,args)},keys:function(){return object_keys(value)}},void 0,function(){return{state:"fulfilled",value:value}})}function coerce(promise){var deferred=defer();return nextTick(function(){try{promise.then(deferred.resolve,deferred.reject,deferred.notify)}catch(exception){deferred.reject(exception)}}),deferred.promise}function master(object){return Promise({isDef:function(){}},function(op,args){return dispatch(object,op,args)},function(){return Q(object).inspect()})}function spread(value,fulfilled,rejected){return Q(value).spread(fulfilled,rejected)}function async(makeGenerator){return function(){function continuer(verb,arg){var result;if("undefined"==typeof StopIteration){try{result=generator[verb](arg)}catch(exception){return reject(exception)}return result.done?result.value:when(result.value,callback,errback)}try{result=generator[verb](arg)}catch(exception){return isStopIteration(exception)?exception.value:reject(exception)}return when(result,callback,errback)}var generator=makeGenerator.apply(this,arguments),callback=continuer.bind(continuer,"next"),errback=continuer.bind(continuer,"throw");return callback()}}function spawn(makeGenerator){Q.done(Q.async(makeGenerator)())}function _return(value){throw new QReturnValue(value)}function promised(callback){return function(){return spread([this,all(arguments)],function(self,args){return callback.apply(self,args)})}}function dispatch(object,op,args){return Q(object).dispatch(op,args)}function all(promises){return when(promises,function(promises){var countDown=0,deferred=defer();return array_reduce(promises,function(undefined,promise,index){var snapshot;isPromise(promise)&&"fulfilled"===(snapshot=promise.inspect()).state?promises[index]=snapshot.value:(++countDown,when(promise,function(value){promises[index]=value,0===--countDown&&deferred.resolve(promises)},deferred.reject,function(progress){deferred.notify({index:index,value:progress})}))},void 0),0===countDown&&deferred.resolve(promises),deferred.promise})}function allResolved(promises){return when(promises,function(promises){return promises=array_map(promises,Q),when(all(array_map(promises,function(promise){return when(promise,noop,noop)})),function(){return promises})})}function allSettled(promises){return Q(promises).allSettled()}function progress(object,progressed){return Q(object).then(void 0,void 0,progressed)}function nodeify(object,nodeback){return Q(object).nodeify(nodeback)}var hasStacks=!1;try{throw new Error}catch(e){hasStacks=!!e.stack}var qFileName,QReturnValue,qStartingLine=captureLine(),noop=function(){},nextTick=function(){function flush(){for(;head.next;){head=head.next;var task=head.task;head.task=void 0;var domain=head.domain;domain&&(head.domain=void 0,domain.enter());try{task()}catch(e){if(isNodeJS)throw domain&&domain.exit(),setTimeout(flush,0),domain&&domain.enter(),e;setTimeout(function(){throw e},0)}domain&&domain.exit()}flushing=!1}var head={task:void 0,next:null},tail=head,flushing=!1,requestTick=void 0,isNodeJS=!1;if(nextTick=function(task){tail=tail.next={task:task,domain:isNodeJS&&process.domain,next:null},flushing||(flushing=!0,requestTick())},"undefined"!=typeof process&&process.nextTick)isNodeJS=!0,requestTick=function(){process.nextTick(flush)};else if("function"==typeof setImmediate)requestTick="undefined"!=typeof window?setImmediate.bind(window,flush):function(){setImmediate(flush)};else if("undefined"!=typeof MessageChannel){var channel=new MessageChannel;channel.port1.onmessage=function(){requestTick=requestPortTick,channel.port1.onmessage=flush,flush()};var requestPortTick=function(){channel.port2.postMessage(0)};requestTick=function(){setTimeout(flush,0),requestPortTick()}}else requestTick=function(){setTimeout(flush,0)};return nextTick}(),call=Function.call,array_slice=uncurryThis(Array.prototype.slice),array_reduce=uncurryThis(Array.prototype.reduce||function(callback,basis){var index=0,length=this.length;if(1===arguments.length)for(;;){if(index in this){basis=this[index++];break}if(++index>=length)throw new TypeError}for(;length>index;index++)index in this&&(basis=callback(basis,this[index],index));return basis}),array_indexOf=uncurryThis(Array.prototype.indexOf||function(value){for(var i=0;i<this.length;i++)if(this[i]===value)return i;return-1}),array_map=uncurryThis(Array.prototype.map||function(callback,thisp){var self=this,collect=[];return array_reduce(self,function(undefined,value,index){collect.push(callback.call(thisp,value,index,self))},void 0),collect}),object_create=Object.create||function(prototype){function Type(){}return Type.prototype=prototype,new Type},object_hasOwnProperty=uncurryThis(Object.prototype.hasOwnProperty),object_keys=Object.keys||function(object){var keys=[];for(var key in object)object_hasOwnProperty(object,key)&&keys.push(key);return keys},object_toString=uncurryThis(Object.prototype.toString);QReturnValue="undefined"!=typeof ReturnValue?ReturnValue:function(value){this.value=value};var STACK_JUMP_SEPARATOR="From previous event:";Q.resolve=Q,Q.nextTick=nextTick,Q.longStackSupport=!1,Q.defer=defer,defer.prototype.makeNodeResolver=function(){var self=this;return function(error,value){error?self.reject(error):arguments.length>2?self.resolve(array_slice(arguments,1)):self.resolve(value)}},Q.Promise=promise,Q.promise=promise,promise.race=race,promise.all=all,promise.reject=reject,promise.resolve=Q,Q.passByCopy=function(object){return object},Promise.prototype.passByCopy=function(){return this},Q.join=function(x,y){return Q(x).join(y)},Promise.prototype.join=function(that){return Q([this,that]).spread(function(x,y){if(x===y)return x;throw new Error("Can't join: not the same: "+x+" "+y)})},Q.race=race,Promise.prototype.race=function(){return this.then(Q.race)},Q.makePromise=Promise,Promise.prototype.toString=function(){return"[object Promise]"},Promise.prototype.then=function(fulfilled,rejected,progressed){function _fulfilled(value){try{return"function"==typeof fulfilled?fulfilled(value):value}catch(exception){return reject(exception)}}function _rejected(exception){if("function"==typeof rejected){makeStackTraceLong(exception,self);try{return rejected(exception)}catch(newException){return reject(newException)}}return reject(exception)}function _progressed(value){return"function"==typeof progressed?progressed(value):value}var self=this,deferred=defer(),done=!1;return nextTick(function(){self.promiseDispatch(function(value){done||(done=!0,deferred.resolve(_fulfilled(value)))},"when",[function(exception){done||(done=!0,deferred.resolve(_rejected(exception)))}])}),self.promiseDispatch(void 0,"when",[void 0,function(value){var newValue,threw=!1;try{newValue=_progressed(value)}catch(e){if(threw=!0,!Q.onerror)throw e;Q.onerror(e)}threw||deferred.notify(newValue)}]),deferred.promise},Q.when=when,Promise.prototype.thenResolve=function(value){return this.then(function(){return value})},Q.thenResolve=function(promise,value){return Q(promise).thenResolve(value)},Promise.prototype.thenReject=function(reason){return this.then(function(){throw reason})},Q.thenReject=function(promise,reason){return Q(promise).thenReject(reason)},Q.nearer=nearer,Q.isPromise=isPromise,Q.isPromiseAlike=isPromiseAlike,Q.isPending=isPending,Promise.prototype.isPending=function(){return"pending"===this.inspect().state},Q.isFulfilled=isFulfilled,Promise.prototype.isFulfilled=function(){return"fulfilled"===this.inspect().state},Q.isRejected=isRejected,Promise.prototype.isRejected=function(){return"rejected"===this.inspect().state};var unhandledReasons=[],unhandledRejections=[],trackUnhandledRejections=!0;Q.resetUnhandledRejections=resetUnhandledRejections,Q.getUnhandledReasons=function(){return unhandledReasons.slice()},Q.stopUnhandledRejectionTracking=function(){resetUnhandledRejections(),trackUnhandledRejections=!1},resetUnhandledRejections(),Q.reject=reject,Q.fulfill=fulfill,Q.master=master,Q.spread=spread,Promise.prototype.spread=function(fulfilled,rejected){return this.all().then(function(array){return fulfilled.apply(void 0,array)},rejected)},Q.async=async,Q.spawn=spawn,Q["return"]=_return,Q.promised=promised,Q.dispatch=dispatch,Promise.prototype.dispatch=function(op,args){var self=this,deferred=defer();return nextTick(function(){self.promiseDispatch(deferred.resolve,op,args)}),deferred.promise},Q.get=function(object,key){return Q(object).dispatch("get",[key])},Promise.prototype.get=function(key){return this.dispatch("get",[key])},Q.set=function(object,key,value){return Q(object).dispatch("set",[key,value])},Promise.prototype.set=function(key,value){return this.dispatch("set",[key,value])},Q.del=Q["delete"]=function(object,key){return Q(object).dispatch("delete",[key])},Promise.prototype.del=Promise.prototype["delete"]=function(key){return this.dispatch("delete",[key])},Q.mapply=Q.post=function(object,name,args){return Q(object).dispatch("post",[name,args])},Promise.prototype.mapply=Promise.prototype.post=function(name,args){return this.dispatch("post",[name,args])},Q.send=Q.mcall=Q.invoke=function(object,name){return Q(object).dispatch("post",[name,array_slice(arguments,2)])},Promise.prototype.send=Promise.prototype.mcall=Promise.prototype.invoke=function(name){return this.dispatch("post",[name,array_slice(arguments,1)])},Q.fapply=function(object,args){return Q(object).dispatch("apply",[void 0,args])},Promise.prototype.fapply=function(args){return this.dispatch("apply",[void 0,args])},Q["try"]=Q.fcall=function(object){return Q(object).dispatch("apply",[void 0,array_slice(arguments,1)])},Promise.prototype.fcall=function(){return this.dispatch("apply",[void 0,array_slice(arguments)])},Q.fbind=function(object){var promise=Q(object),args=array_slice(arguments,1);return function(){return promise.dispatch("apply",[this,args.concat(array_slice(arguments))])}},Promise.prototype.fbind=function(){var promise=this,args=array_slice(arguments);return function(){return promise.dispatch("apply",[this,args.concat(array_slice(arguments))])}},Q.keys=function(object){return Q(object).dispatch("keys",[])},Promise.prototype.keys=function(){return this.dispatch("keys",[])},Q.all=all,Promise.prototype.all=function(){return all(this)},Q.allResolved=deprecate(allResolved,"allResolved","allSettled"),Promise.prototype.allResolved=function(){return allResolved(this)},Q.allSettled=allSettled,Promise.prototype.allSettled=function(){return this.then(function(promises){return all(array_map(promises,function(promise){function regardless(){return promise.inspect()}return promise=Q(promise),promise.then(regardless,regardless)}))})},Q.fail=Q["catch"]=function(object,rejected){return Q(object).then(void 0,rejected)},Promise.prototype.fail=Promise.prototype["catch"]=function(rejected){return this.then(void 0,rejected)},Q.progress=progress,Promise.prototype.progress=function(progressed){return this.then(void 0,void 0,progressed)},Q.fin=Q["finally"]=function(object,callback){return Q(object)["finally"](callback)},Promise.prototype.fin=Promise.prototype["finally"]=function(callback){return callback=Q(callback),this.then(function(value){return callback.fcall().then(function(){return value})},function(reason){return callback.fcall().then(function(){throw reason})})},Q.done=function(object,fulfilled,rejected,progress){return Q(object).done(fulfilled,rejected,progress)},Promise.prototype.done=function(fulfilled,rejected,progress){var onUnhandledError=function(error){nextTick(function(){if(makeStackTraceLong(error,promise),!Q.onerror)throw error;Q.onerror(error)})},promise=fulfilled||rejected||progress?this.then(fulfilled,rejected,progress):this;"object"==typeof process&&process&&process.domain&&(onUnhandledError=process.domain.bind(onUnhandledError)),promise.then(void 0,onUnhandledError)},Q.timeout=function(object,ms,message){return Q(object).timeout(ms,message)},Promise.prototype.timeout=function(ms,message){var deferred=defer(),timeoutId=setTimeout(function(){deferred.reject(new Error(message||"Timed out after "+ms+" ms"))},ms);return this.then(function(value){clearTimeout(timeoutId),deferred.resolve(value)},function(exception){clearTimeout(timeoutId),deferred.reject(exception)},deferred.notify),deferred.promise},Q.delay=function(object,timeout){return void 0===timeout&&(timeout=object,object=void 0),Q(object).delay(timeout)},Promise.prototype.delay=function(timeout){return this.then(function(value){var deferred=defer();return setTimeout(function(){deferred.resolve(value)},timeout),deferred.promise})},Q.nfapply=function(callback,args){return Q(callback).nfapply(args)},Promise.prototype.nfapply=function(args){var deferred=defer(),nodeArgs=array_slice(args);return nodeArgs.push(deferred.makeNodeResolver()),this.fapply(nodeArgs).fail(deferred.reject),deferred.promise},Q.nfcall=function(callback){var args=array_slice(arguments,1);return Q(callback).nfapply(args)},Promise.prototype.nfcall=function(){var nodeArgs=array_slice(arguments),deferred=defer();return nodeArgs.push(deferred.makeNodeResolver()),this.fapply(nodeArgs).fail(deferred.reject),deferred.promise},Q.nfbind=Q.denodeify=function(callback){var baseArgs=array_slice(arguments,1);return function(){var nodeArgs=baseArgs.concat(array_slice(arguments)),deferred=defer();return nodeArgs.push(deferred.makeNodeResolver()),Q(callback).fapply(nodeArgs).fail(deferred.reject),deferred.promise}},Promise.prototype.nfbind=Promise.prototype.denodeify=function(){var args=array_slice(arguments);return args.unshift(this),Q.denodeify.apply(void 0,args)},Q.nbind=function(callback,thisp){var baseArgs=array_slice(arguments,2);return function(){function bound(){return callback.apply(thisp,arguments)}var nodeArgs=baseArgs.concat(array_slice(arguments)),deferred=defer();return nodeArgs.push(deferred.makeNodeResolver()),Q(bound).fapply(nodeArgs).fail(deferred.reject),deferred.promise}},Promise.prototype.nbind=function(){var args=array_slice(arguments,0);return args.unshift(this),Q.nbind.apply(void 0,args)},Q.nmapply=Q.npost=function(object,name,args){return Q(object).npost(name,args)},Promise.prototype.nmapply=Promise.prototype.npost=function(name,args){var nodeArgs=array_slice(args||[]),deferred=defer();return nodeArgs.push(deferred.makeNodeResolver()),this.dispatch("post",[name,nodeArgs]).fail(deferred.reject),deferred.promise},Q.nsend=Q.nmcall=Q.ninvoke=function(object,name){var nodeArgs=array_slice(arguments,2),deferred=defer();return nodeArgs.push(deferred.makeNodeResolver()),Q(object).dispatch("post",[name,nodeArgs]).fail(deferred.reject),deferred.promise},Promise.prototype.nsend=Promise.prototype.nmcall=Promise.prototype.ninvoke=function(name){var nodeArgs=array_slice(arguments,1),deferred=defer();return nodeArgs.push(deferred.makeNodeResolver()),this.dispatch("post",[name,nodeArgs]).fail(deferred.reject),deferred.promise},Q.nodeify=nodeify,Promise.prototype.nodeify=function(nodeback){return nodeback?void this.then(function(value){nextTick(function(){nodeback(null,value)})},function(error){nextTick(function(){nodeback(error)})}):this};var qEndingLine=captureLine();return Q});var JPAK={Constants:{verbosity:3},Generics:{},Loader:{},Classes:{},Tools:{}};!function(){var inNode="undefined"!=typeof module&&"undefined"!=typeof module.exports;inNode&&(JPAK.Tools.toBuffer=function(ab){for(var buffer=new Buffer(ab.byteLength),view=new Uint8Array(ab),i=0;i<buffer.length;++i)buffer[i]=view[i];return buffer},JPAK.Tools.toArrayBuffer=function(buffer){for(var ab=new ArrayBuffer(buffer.length),view=new Uint8Array(ab),i=0;i<buffer.length;++i)view[i]=buffer[i];return ab}),JPAK.Tools.cleanArray=function(array,deleteValue){for(var i=0;i<array.length;i++)array[i]===deleteValue&&(array.splice(i,1),i--);return array},Uint8Array.prototype.asString=function(){for(var o="",i=0;i<this.byteLength;i++)o+=String.fromCharCode(this[i]);return o},Uint8Array.prototype.putString=function(offset,string){void 0===string&&(string=offset,offset=0);for(var i=0;i<string.length;i++)this[offset+i]=string.charCodeAt(i);return offset+string.length},JPAK.Generics.genericToObject=function(){var output={};for(var property in this)this.hasOwnProperty(property)&&(output[property]=void 0!==this[property].toObject?this[property].toObject():this[property]);return output},JPAK.Generics.genericFromObject=function(object){for(var property in object)object.hasOwnProperty(property)&&(this[property]=object[property])},JPAK.Generics.genericjToJSON=function(){return JSON.stringify(this.toObject())},JPAK.Generics.genericjFromJSON=function(json){this.fromObject(JSON.parse(json))},JPAK.Constants.Base64_Encoding="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",JPAK.Tools.ArrayBufferToBase64=function(arrayBuffer){for(var a,b,c,d,chunk,base64="",bytes=new Uint8Array(arrayBuffer),byteLength=bytes.byteLength,byteRemainder=byteLength%3,mainLength=byteLength-byteRemainder,i=0;mainLength>i;i+=3)chunk=bytes[i]<<16|bytes[i+1]<<8|bytes[i+2],a=(16515072&chunk)>>18,b=(258048&chunk)>>12,c=(4032&chunk)>>6,d=63&chunk,base64+=JPAK.Constants.Base64_Encoding[a]+JPAK.Constants.Base64_Encoding[b]+JPAK.Constants.Base64_Encoding[c]+JPAK.Constants.Base64_Encoding[d];return 1===byteRemainder?(chunk=bytes[mainLength],a=(252&chunk)>>2,b=(3&chunk)<<4,base64+=JPAK.Constants.Base64_Encoding[a]+JPAK.Constants.Base64_Encoding[b]+"=="):2===byteRemainder&&(chunk=bytes[mainLength]<<8|bytes[mainLength+1],a=(64512&chunk)>>10,b=(1008&chunk)>>4,c=(15&chunk)<<2,base64+=JPAK.Constants.Base64_Encoding[a]+JPAK.Constants.Base64_Encoding[b]+JPAK.Constants.Base64_Encoding[c]+"="),base64},JPAK.Tools.debug=function(){JPAK.Constants.verbosity>=3&&([].splice.call(arguments,0,0,"(JPAK Debug)"),console.debug?console.debug.apply(console,arguments):console.log.apply(console,arguments))},JPAK.Tools.error=function(){JPAK.Constants.verbosity>=0&&([].splice.call(arguments,0,0,"(JPAK Error)"),console.error?console.error.apply(console,arguments):console.log.apply(console,arguments))},JPAK.Tools.warning=function(){JPAK.Constants.verbosity>=1&&([].splice.call(arguments,0,0,"(JPAK Warning)"),console.log.apply(console,arguments))},JPAK.Tools.info=function(){JPAK.Constants.verbosity>=2&&([].splice.call(arguments,0,0,"(JPAK Info)"),console.info?console.info.apply(console,arguments):console.log.apply(console,arguments))},JPAK.Tools.d=JPAK.Tools.debug,JPAK.Tools.e=JPAK.Tools.error,JPAK.Tools.w=JPAK.Tools.warning,JPAK.Tools.i=JPAK.Tools.info,JPAK.Tools.l=JPAK.Tools.info,JPAK.Tools.log=JPAK.Tools.info,JPAK.Constants.MAGIC_TYPE={JPAK1:0,JMS1:1,JDS1:2},JPAK.Constants.REVERSE_MAGIC_TYPE={0:"JPAK1",1:"JMS1",2:"JDS1"}}(),function(){var inNode="undefined"!=typeof module&&"undefined"!=typeof module.exports;if(inNode){var fs=require("fs");void 0===typeof Q&&(Q=require("q"));var NodeDataLoader=function(parameters){this.url=parameters.url,this.partial=parameters.partial||!1,this.partialFrom=parameters.partialFrom||0,this.partialTo=parameters.partialTo||0,this.fetchSize=parameters.fetchSize||!1,this.callbacks={load:[],error:[]}};NodeDataLoader.prototype._reportError=function(error){for(var cb in this.callbacks.error)this.callbacks.error[cb](error);this.def.reject(error)},NodeDataLoader.prototype._reportLoad=function(data){for(var cb in this.callbacks.load)this.callbacks.load[cb](data);this.def.resolve(data)},NodeDataLoader.prototype.start=function(){this.def=Q.defer();var _this=this;return this.fetchSize?fs.stat(_this.url,function(err,stats){err?(_this.def.reject(err),_this._reportError({text:"Error loading file!"+err})):(_this.def.resolve(stats.size),_this._reportLoad(stats.size))}):function(){var def=Q.defer();return fs.open(_this.url,"r",function(err,fd){err?(_this.def.reject(err),def.reject(err)):def.resolve(fd)}),def.promise}().then(function(fd){var def=Q.defer();return function(){var sizeDef=Q.defer();return _this.partial?sizeDef.resolve(_this.partialTo-_this.partialFrom+1):fs.fstat(fd,function(err,stats){err?sizeDef.reject(err):sizeDef.resolve(stats.size)}),sizeDef.promise}().then(function(readsize){var loadDef=Q.defer(),buffer=new Buffer(readsize),position=_this.partial?_this.partialFrom:0;return fs.read(fd,buffer,0,readsize,position,function(err,bytesRead,buffer){err?loadDef.reject(err):loadDef.resolve(buffer)}),loadDef.promise}).then(function(data){def.resolve(JPAK.Tools.toArrayBuffer(data)),_this._reportLoad(JPAK.Tools.toArrayBuffer(data))})["catch"](function(err){def.reject(err),_this._reportError({text:"Error loading file!"+err})}),def.promise}),this.def.promise},NodeDataLoader.prototype.on=function(event,cb){event in this.callbacks&&this.callbacks[event].push(function(data){cb(data)})},JPAK.Tools.DataLoader=NodeDataLoader}else{var DataLoader=function(parameters){var _this=this;this.xhr=new XMLHttpRequest,this.method=parameters.method||"GET",this.url=parameters.url,this.responseType=parameters.responseType||"arraybuffer",this.partial=parameters.partial||!1,this.partialFrom=parameters.partialFrom||0,this.partialTo=parameters.partialTo||0,this.fetchSize=parameters.fetchSize||!1,this.callbacks={load:[],error:[],progress:[]},this.xhr.onprogress=function(e){if(e.lengthComputable&&void 0!==_this.onprogress){var percentComplete=(e.loaded/e.total*1e4>>0)/100;_this._reportProgress({loaded:e.loaded,total:e.total,percent:percentComplete})}},this.xhr.onload=function(e){this.status>=200&&this.status<300?_this.fetchSize?_this._reportLoad(parseInt(this.getResponseHeader("Content-Length"))):_this._reportLoad(this.response):_this._reportError({text:"Error loading file! HTTP Status Code: "+this.status,errorcode:this.status})},this.xhr.onreadystatechange=function(e){4===this.readyState&&(this.status<200||this.status>=300)&&(JPAK.Tools.e("Error loading url "+_this.url+" ("+this.status+"): "+this.statusText),_this._reportError({text:this.statusText,errorcode:this.status}))}};DataLoader.prototype._reportProgress=function(progress){for(var cb in this.callbacks.progress)this.callbacks.progress[cb](progress);this.def.notify(progress)},DataLoader.prototype._reportError=function(error){for(var cb in this.callbacks.error)this.callbacks.error[cb](error);this.def.reject(error)},DataLoader.prototype._reportLoad=function(data){for(var cb in this.callbacks.load)this.callbacks.load[cb](data);this.def.resolve(data)},DataLoader.prototype.start=function(){return this.fetchSize&&(this.method="HEAD",this.partial=!1),this.xhr.open(this.method,this.url,!0),this.xhr.responseType=this.responseType,this.partial&&this.xhr.setRequestHeader("Range","bytes="+this.partialFrom+"-"+this.partialTo),this.def=Q.defer(),this.xhr.send(),this.def.promise},DataLoader.prototype.on=function(event,cb){event in this.callbacks&&this.callbacks[event].push(function(data){cb(data)})},JPAK.Tools.DataLoader=DataLoader}}(),function(){var inNode="undefined"!=typeof module&&"undefined"!=typeof module.exports,JPKDirectoryEntry=function(name,path,numfiles,directories,files,aeskey){this.name=name||"",this.path=path||"",this.numfiles=numfiles||0,this.directories=directories||{},this.aeskey=aeskey||"",this.files=files||{}};if(JPKDirectoryEntry.prototype.toObject=JPAK.Generics.genericToObject,JPKDirectoryEntry.prototype.fromObject=JPAK.Generics.genericFromObject,JPKDirectoryEntry.prototype.jToJSON=JPAK.Generics.genericjToJSON,JPKDirectoryEntry.prototype.jFromJSON=JPAK.Generics.genericjFromJSON,inNode){var fs=require("fs"),path=require("path");JPKDirectoryEntry.prototype.fromDirectory=function(folder,jds){if(fs.lstatSync(folder).isDirectory()){var folders=fs.readdirSync(folder);for(var fn in folders){var f=folders[fn];fs.lstatSync(folder+"/"+f).isFile()?this.addFile(folder+"/"+f,jds):fs.lstatSync(folder+"/"+f).isDirectory()&&(this.directories.hasOwnProperty(path.basename(f))||(this.directories[path.basename(f)]=new JPAK.Classes.JPKDirectoryEntry(path.basename(f))),this.directories[path.basename(f)].fromDirectory(folder+"/"+f,jds))}}else this.addFile(folder,jds)},JPKDirectoryEntry.prototype.addFile=function(filepath,jds,normalizeName){console.log(" Adding "+(normalizeName?path.basename(filepath):filepath)+" to "+this.name);var addedData=jds.addFromFile(filepath);this.files[path.basename(filepath)]=new JPAK.Classes.JPKFileEntry(path.basename(filepath),normalizeName?path.basename(filepath):filepath,addedData[0],addedData[1],"",!1,jds.name),this.numfiles++}}JPAK.Classes.JPKDirectoryEntry=JPKDirectoryEntry}(),function(){var JPKFileEntry=function(name,path,offset,size,aeskey,zlib,volume,md5){this.name=name||"",this.path=path||"",this.offset=offset||0,this.size=size||0,this.aeskey=aeskey||"",this.zlib=zlib||!1,this.volume=volume||"",this.md5=md5||""};JPKFileEntry.prototype.toObject=JPAK.Generics.genericToObject,JPKFileEntry.prototype.fromObject=JPAK.Generics.genericFromObject,JPKFileEntry.prototype.jToJSON=JPAK.Generics.genericjToJSON,JPKFileEntry.prototype.jFromJSON=JPAK.Generics.genericjFromJSON,JPAK.Classes.JPKFileEntry=JPKFileEntry}(),function(){var inNode="undefined"!=typeof module&&"undefined"!=typeof module.exports;
if(inNode){var fs=require("fs"),JDS=(require("path"),function(name,filename){this.MAGIC="JDS1",this.name=name||"",this.filename=filename||"",fs.existsSync(filename)&&fs.statSync(filename).isFile()?this.fd=fs.openSync(filename,"r+"):this.fd=fs.openSync(filename,"w+"),fs.statSync(filename).size<12&&this.__buildHeader(),this.currentPosition=12,this.CHUNK=4096});JDS.prototype.__buildHeader=function(){console.log("Creating Header in "+this.filename),fs.writeSync(this.fd,this.MAGIC),fs.writeSync(this.fd,"\x00\x00\x00\x00\x00\x00\x00\x00")},JDS.prototype.add=function(data){var offset=this.currentPosition,o=fs.writeSync(this.fd,data);return this.currentPosition+=o,[offset,data.length]},JDS.prototype.addFromFile=function(filename){for(var newFd=fs.openSync(filename,"r"),offset=this.currentPosition,size=fs.statSync(filename).size,c=0,data=new Buffer(this.CHUNK);size>c;){var chunk=size-c>this.CHUNK?this.CHUNK:size-c;fs.readSync(newFd,data,0,chunk),fs.writeSync(this.fd,data,0,chunk,this.currentPosition),c+=chunk,this.currentPosition+=chunk}return fs.closeSync(newFd),[offset,size]},JDS.prototype.close=function(){fs.closeSync(this.fd)},JPAK.Classes.JDS=JDS}}(),function(){var inNode="undefined"!=typeof module&&"undefined"!=typeof module.exports,JMS=function(volumeTable,fileTable,producerId,flags,userflags){this.volumeTable=volumeTable||{},this.fileTable=fileTable||new JPAK.Classes.JPKDirectoryEntry("root"),this.producerId=producerId||0,this.userflags=userflags||0,this.MAGIC="JMS1"};if(JMS.prototype.toObject=JPAK.Generics.genericToObject,JMS.prototype.fromObject=JPAK.Generics.genericFromObject,JMS.prototype.jToJSON=JPAK.Generics.genericjToJSON,JMS.prototype.jFromJSON=JPAK.Generics.genericjFromJSON,JMS.prototype.fromBinary=function(data){inNode&&(data=JPAK.Tools.toArrayBuffer(data));var MagicNumber=new Uint8Array(data.slice(0,4)).asString();if(MagicNumber!==this.MAGIC)return void console.error("MagicNumber doesn't match! Expected: "+this.MAGIC+" got "+MagicNumber);var dV=new DataView(data),fileTableOffset=dV.getUint32(data.byteLength-4),volumeTableSize=fileTableOffset-12,fileTable=(data.byteLength-fileTableOffset-12,new Uint8Array(data.slice(fileTableOffset,data.byteLength-16)).asString()),volumeTable=(new Uint8Array(data.slice(12,volumeTableSize+12)).asString(),JSON.parse(new Uint8Array(data.slice(12,volumeTableSize+12)).asString()));this.fileTable=new JPAK.Classes.JPKDirectoryEntry,this.fileTable.jFromJSON(fileTable),this.volumeTable={};for(var v in volumeTable){var newVolume=new JPAK.Classes.JPKVolumeEntry;newVolume.fromObject(volumeTable[v]),this.volumeTable[v]=newVolume}},JMS.prototype.toBinary=function(){var fileTable=this.fileTable.jToJSON(),volumeTable={};for(var v in this.volumeTable)volumeTable[v]=this.volumeTable[v].toObject();volumeTable=JSON.stringify(volumeTable);var buffer=new ArrayBuffer(12+volumeTable.length+fileTable.length+16),u8=new Uint8Array(buffer),dv=new DataView(buffer);dv.setUint32(buffer.byteLength-16,this.producerId,!0),dv.setUint32(buffer.byteLength-12,this.flags,!0),dv.setUint32(buffer.byteLength-8,this.userflags,!0),u8.putString(this.MAGIC);var fileTableOffset=u8.putString(12,volumeTable);return u8.putString(fileTableOffset,fileTable),dv.setUint32(buffer.byteLength-4,fileTableOffset,!0),buffer},inNode){var fs=require("fs"),path=require("path");JMS.prototype.fromDirectory=function(folder,jds){this.fileTable.fromDirectory(folder,jds)},JMS.prototype.fromArgs=function(args,jds){for(var i in args){var folder=args[i];console.log("Adding from arg "+folder),fs.lstatSync(folder).isDirectory()?(this.fileTable.directories.hasOwnProperty(path.basename(folder))||(this.fileTable.directories[path.basename(folder)]=new JPAK.Classes.JPKDirectoryEntry(path.basename(folder))),this.fileTable.directories[path.basename(folder)].fromDirectory(folder,jds)):this.fileTable.addFile(folder,jds,!0)}},JMS.prototype.addVolume=function(jds){jds.name in this.volumeTable&&(console.error(jds.name+" already in volumes list."),process.exit(1)),this.volumeTable[jds.name]=new JPAK.Classes.JPKVolumeEntry(jds.filename)},JMS.prototype.toFile=function(filename){var fd=fs.openSync(filename,"w"),binData=this.toBinary();fs.writeSync(fd,JPAK.Tools.toBuffer(binData),0,binData.byteLength),fs.closeSync(fd)}}JPAK.Classes.JMS=JMS}(),function(){var inNode="undefined"!=typeof module&&"undefined"!=typeof module.exports;inNode&&(Q=require("q"));var Loader=function(parameters){void 0!==parameters&&(this.jpakfile=parameters.file),this.tableLoaded=!1};Loader.prototype._proceedJPAK1=function(){var _this=this;return JPAK.Tools.d("JPAK1 Format"),this.jpakType="JPAK1",this._p_getFileSize().then(function(){return _this._p_jpak1_loadFileTable()})},Loader.prototype._proceedJMS1=function(){var _this=this;return this.jpakType="JMS",JPAK.Tools.d("JMS1 Format"),this._p_getFileSize().then(function(){return _this._p_jms1_loadFileTable()})},Loader.prototype.checkMagic=function(magic){var Magic0=new Uint8Array(magic.slice(0,4)).asString(),Magic1=new Uint8Array(magic.slice(0,5)).asString();return JPAK.Constants.MAGIC_TYPE.hasOwnProperty(Magic0)?JPAK.Constants.MAGIC_TYPE[Magic0]:JPAK.Constants.MAGIC_TYPE.hasOwnProperty(Magic1)?JPAK.Constants.MAGIC_TYPE[Magic1]:null},Loader.prototype.load=function(){var _this=this,MagicLoader=new JPAK.Tools.DataLoader({url:this.jpakfile,partial:!0,partialFrom:0,partialTo:5});return MagicLoader.start().then(function(data){var def=Q.defer(),version=_this.checkMagic(data);switch(JPAK.Tools.d("Version: "+version),version){case JPAK.Constants.MAGIC_TYPE.JPAK1:return _this._proceedJPAK1();case JPAK.Constants.MAGIC_TYPE.JMS1:return _this._proceedJMS1();case null:JPAK.Tools.e("Invalid magic!"),def.reject();break;default:JPAK.Tools.e("Invalid Magic Type to load: "+JPAK.Constants.REVERSE_MAGIC_TYPE[version]),def.reject()}return def.promise})},Loader.prototype.findDirectoryEntry=function(path){var base=this.fileTable;if(this.tableLoaded&&"/"!==path){path=JPAK.Tools.cleanArray(path.split("/"),"");for(var dir="",ok=!0,i=0;i<path.length;i++){if(dir=path[i],!(dir in base.directories)){ok=!1;break}base=base.directories[dir]}ok||(base=null)}return base},Loader.prototype.findFileEntry=function(path){var pathblock=JPAK.Tools.cleanArray(path.split("/"),""),filename=pathblock[pathblock.length-1];path=path.replace(filename,"");var base=this.findDirectoryEntry(path);return void 0!==base&&filename in base.files?base.files[filename]:void 0},Loader.prototype.ls=function(path){var out={files:[],dirs:[]};if(this.tableLoaded){var base=this.findDirectoryEntry(path);if(void 0!==base){for(var i in base.files)out.files.push(base.files[i]);for(i in base.directories)out.dirs.push({name:base.directories[i].name,numfiles:base.directories[i].numfiles})}else out.error="Directory not found!"}else out.error="Not loaded";return out},Loader.prototype.getFile=function(path,type){var def=Q.defer();switch(this.jpakType){case"JPAK1":return this._p_jpak1_getFileBlob(path,type);case"JMS":return this._p_jms1_getFileBlob(path,type);default:def.reject("Not a valid jpak file!")}return def.promise},Loader.prototype.getFileArrayBuffer=function(path,type){var def=Q.defer();switch(this.jpakType){case"JPAK1":return this._p_jpak1_getFile(path,type);case"JMS":return this._p_jms1_getFile(path,type);default:def.reject("Not a valid jpak file!")}return def.promise},Loader.prototype.getBase64File=function(path,type){var def=Q.defer();return this.getFileArrayBuffer(path,type).then(function(data){def.resolve(JPAK.Tools.ArrayBufferToBase64(data))}).fail(function(error){def.reject(error)}),def.promise},inNode||(Loader.prototype.getHTMLDataURIFile=function(path,type,encoding){var def=Q.defer();return this.getBase64File(path,type).then(function(data){void 0===data&&def.reject("Data is undefined!"),void 0!==encoding&&null!==encoding?def.resolve("data:"+type+";charset="+encoding+";base64,"+data):def.resolve("data:"+type+";base64,"+data)}),def.promise},Loader.prototype.getFileURL=function(path,type){return this.getFile(path,type).then(function(blob){var def=Q.defer();return void 0!==blob?def.resolve(URL.createObjectURL(blob)):(JPAK.Tools.e('Error: Cannot find file: "'+path+'"'),def.reject('Error: Cannot find file: "'+path+'"')),def.promise})}),Loader.prototype._p_getFileSize=function(){var _this=this,SizeLoader=new JPAK.Tools.DataLoader({url:this.jpakfile,fetchSize:!0});return SizeLoader.start().then(function(size){var def=Q.defer();return _this.fileSize=size,JPAK.Tools.d("File Size: "+size),def.resolve(size),def.promise})},Loader.prototype._p_jpak1_loadFileTable=function(){var _this=this,tableOffsetLoader=new JPAK.Tools.DataLoader({url:this.jpakfile,partial:!0,partialFrom:this.fileSize-4,partialTo:this.fileSize});return tableOffsetLoader.start().then(function(data){_this.fileTableOffset=new DataView(data.slice(data.byteLength-4,data.byteLength)).getUint32(0,!0);var fileTableLoader=new JPAK.Tools.DataLoader({url:_this.jpakfile,partial:!0,partialFrom:_this.fileTableOffset,partialTo:_this.fileSize-5});return fileTableLoader.start()}).then(function(data){var def=Q.defer();data=new Uint8Array(data).asString();try{_this.fileTable=JSON.parse(data),_this.tableLoaded=!0,def.resolve(_this.fileTable)}catch(e){def.reject(e)}return def.promise})},Loader.prototype._p_jpak1_getFile=function(path,type){var def=Q.defer(),file=this.findFileEntry(path);type=type||"application/octet-binary";var fileLoader=new JPAK.Tools.DataLoader({url:this.jpakfile,partial:!0,partialFrom:file.offset,partialTo:file.offset+file.size-1});return fileLoader.start().then(function(data){void 0!==file.compressed&&file.compressed&&(data=JPAK.Tools.GZ.decompress(data)),def.resolve(data)}).fail(function(error){def.reject(error)}),def.promise},Loader.prototype._p_jpak1_getFileBlob=function(path,type){var def=Q.defer();return this._p_jpak1_getFile(path,type).then(function(data){var ret=new Uint8Array(data).buffer;inNode||(ret=new Blob([ret],{type:type})),def.resolve(ret)}).fail(function(error){def.reject(error)}),def.promise},Loader.prototype._p_jms1_loadFileTable=function(){var _this=this,tableOffsetLoader=new JPAK.Tools.DataLoader({url:this.jpakfile,partial:!0,partialFrom:this.fileSize-4,partialTo:this.fileSize});return tableOffsetLoader.start().then(function(data){_this.fileTableOffset=new DataView(data).getUint32(0,!0);var fileTableLoader=new JPAK.Tools.DataLoader({url:_this.jpakfile,partial:!0,partialFrom:_this.fileTableOffset,partialTo:_this.fileSize-16-1});return fileTableLoader.start()}).then(function(data){data=new Uint8Array(data).asString(),_this.fileTable=JSON.parse(data),_this.tableLoaded=!0;var volumeTableLoader=new JPAK.Tools.DataLoader({url:_this.jpakfile,partial:!0,partialFrom:12,partialTo:_this.fileTableOffset-1});return volumeTableLoader.start()}).then(function(data){var def=Q.defer();return data=new Uint8Array(data).asString(),_this.volumeTable=JSON.parse(data),_this.volumeTableLoaded=!0,def.resolve(_this.fileTable),def.promise})},Loader.prototype._p_jms1_getFile=function(path,type){var def=Q.defer(),file=this.findFileEntry(path);if(type=type||"application/octet-binary",file.volume in this.volumeTable){var volumePath=this.volumeTable[file.volume].filename,fileLoader=new JPAK.Tools.DataLoader({url:volumePath,partial:!0,partialFrom:file.offset,partialTo:file.offset+file.size-1});fileLoader.start().then(function(data){void 0!==file.compressed&&file.compressed&&(data=JPAK.Tools.GZ.decompress(data)),def.resolve(data)}).fail(function(error){def.reject(error)})}else def.reject('Volume "'+file.volume+'" not found!');return def.promise},Loader.prototype._p_jms1_getFileBlob=function(path,type){var def=Q.defer();return this._p_jms1_getFile(path,type).then(function(data){var ret=new Uint8Array(data).buffer;inNode||(ret=new Blob([ret],{type:type})),def.resolve(ret)}).fail(function(error){def.reject(error)}),def.promise},JPAK.Loader=Loader}(),function(){var JPKVolumeEntry=function(filename){this.filename=filename};JPKVolumeEntry.prototype.toObject=JPAK.Generics.genericToObject,JPKVolumeEntry.prototype.fromObject=JPAK.Generics.genericFromObject,JPKVolumeEntry.prototype.jToJSON=JPAK.Generics.genericjToJSON,JPKVolumeEntry.prototype.jFromJSON=JPAK.Generics.genericjFromJSON,JPAK.Classes.JPKVolumeEntry=JPKVolumeEntry}(),function(){var GZ={},bitReverse=[0,128,64,192,32,160,96,224,16,144,80,208,48,176,112,240,8,136,72,200,40,168,104,232,24,152,88,216,56,184,120,248,4,132,68,196,36,164,100,228,20,148,84,212,52,180,116,244,12,140,76,204,44,172,108,236,28,156,92,220,60,188,124,252,2,130,66,194,34,162,98,226,18,146,82,210,50,178,114,242,10,138,74,202,42,170,106,234,26,154,90,218,58,186,122,250,6,134,70,198,38,166,102,230,22,150,86,214,54,182,118,246,14,142,78,206,46,174,110,238,30,158,94,222,62,190,126,254,1,129,65,193,33,161,97,225,17,145,81,209,49,177,113,241,9,137,73,201,41,169,105,233,25,153,89,217,57,185,121,249,5,133,69,197,37,165,101,229,21,149,85,213,53,181,117,245,13,141,77,205,45,173,109,237,29,157,93,221,61,189,125,253,3,131,67,195,35,163,99,227,19,147,83,211,51,179,115,243,11,139,75,203,43,171,107,235,27,155,91,219,59,187,123,251,7,135,71,199,39,167,103,231,23,151,87,215,55,183,119,247,15,143,79,207,47,175,111,239,31,159,95,223,63,191,127,255],cplens=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],cplext=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,99,99],cpdist=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],cpdext=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],border=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],NAMEMAX=256;GZ.decompress=function(data){var arr=new Uint8Array(data),gzip=new GZ.Unzip(arr).unzip();return gzip.length>0&&gzip[0].length>0?data=gzip[0][0]:(data="",JPAK.Tools.e("Error uncompressing data!")),JPAK.Tools.String2ArrayBuffer(data)},GZ.Unzip=function(barray){function readByte(){return bits+=8,barraylen>bytepos?barray[bytepos++]:-1}function byteAlign(){bb=1}function readBit(){var carry;return bits++,carry=1&bb,bb>>=1,0===bb&&(bb=readByte(),carry=1&bb,bb=bb>>1|128),carry}function readBits(a){for(var res=0,i=a;i--;)res=res<<1|readBit();return a&&(res=bitReverse[res]>>8-a),res}function flushBuffer(){bIdx=0}function addBuffer(a){SIZE++,buf32k[bIdx++]=a,outputArr.push(String.fromCharCode(a)),32768===bIdx&&(bIdx=0)}function HufNode(){this.b0=0,this.b1=0,this.jump=null,this.jumppos=-1}function isPat(){for(;;){if(fpos[len]>=fmax)return-1;if(flens[fpos[len]]===len)return fpos[len]++;fpos[len]++}}function rec(){var tmp,curplace=Places[treepos];if(17===len)return-1;if(treepos++,len++,tmp=isPat(),tmp>=0)curplace.b0=tmp;else if(curplace.b0=32768,rec())return-1;if(tmp=isPat(),tmp>=0)curplace.b1=tmp,curplace.jump=null;else if(curplace.b1=32768,curplace.jump=Places[treepos],curplace.jumppos=treepos,rec())return-1;return len--,0}function createTree(currentTree,numval,lengths,show){var i;for(Places=currentTree,treepos=0,flens=lengths,fmax=numval,i=0;17>i;i++)fpos[i]=0;return len=0,rec()?-1:0}function decodeValue(currentTree){for(var len,i,b,xtreepos=0,X=currentTree[xtreepos];;)if(b=readBit()){if(!(32768&X.b1))return X.b1;for(X=X.jump,len=currentTree.length,i=0;len>i;i++)if(currentTree[i]===X){xtreepos=i;break}}else{if(!(32768&X.b0))return X.b0;xtreepos++,X=currentTree[xtreepos]}}function deflateLoop(){var last,c,type,i,j,l,ll,ll2,len,blockLen,dist,cSum,n,literalCodes,distCodes,lenCodes,z;do if(last=readBit(),type=readBits(2),0===type)for(byteAlign(),blockLen=readByte(),blockLen|=readByte()<<8,cSum=readByte(),cSum|=readByte()<<8,65535&(blockLen^~cSum)&&JPAK.Tools.d("BlockLen checksum mismatch\n");blockLen--;)c=readByte(),addBuffer(c);else if(1===type)for(;;)if(j=bitReverse[readBits(7)]>>1,j>23?(j=j<<1|readBit(),j>199?(j-=128,j=j<<1|readBit()):(j-=48,j>143&&(j+=136))):j+=256,256>j)addBuffer(j);else{if(256===j)break;for(j-=257,len=readBits(cplext[j])+cplens[j],j=bitReverse[readBits(5)]>>3,cpdext[j]>8?(dist=readBits(8),dist|=readBits(cpdext[j]-8)<<8):dist=readBits(cpdext[j]),dist+=cpdist[j],j=0;len>j;j++)c=buf32k[bIdx-dist&32767],addBuffer(c)}else if(2===type){for(ll=new Array(320),literalCodes=257+readBits(5),distCodes=1+readBits(5),lenCodes=4+readBits(4),j=0;19>j;j++)ll[j]=0;for(j=0;lenCodes>j;j++)ll[border[j]]=readBits(3);for(len=distanceTree.length,i=0;len>i;i++)distanceTree[i]=new HufNode;if(createTree(distanceTree,19,ll,0))return flushBuffer(),1;for(n=literalCodes+distCodes,i=0,z=-1;n>i;)if(z++,j=decodeValue(distanceTree),16>j)ll[i++]=j;else if(16===j){if(j=3+readBits(2),i+j>n)return flushBuffer(),1;for(l=i?ll[i-1]:0;j--;)ll[i++]=l}else{if(j=17===j?3+readBits(3):11+readBits(7),i+j>n)return flushBuffer(),1;for(;j--;)ll[i++]=0}for(len=literalTree.length,i=0;len>i;i++)literalTree[i]=new HufNode;if(createTree(literalTree,literalCodes,ll,0))return flushBuffer(),1;for(len=literalTree.length,i=0;len>i;i++)distanceTree[i]=new HufNode;for(ll2=[],i=literalCodes;i<ll.length;i++)ll2[i-literalCodes]=ll[i];if(createTree(distanceTree,distCodes,ll2,0))return flushBuffer(),1;for(;;)if(j=decodeValue(literalTree),j>=256){if(j-=256,0===j)break;for(j-=1,len=readBits(cplext[j])+cplens[j],j=decodeValue(distanceTree),cpdext[j]>8?(dist=readBits(8),dist|=readBits(cpdext[j]-8)<<8):dist=readBits(cpdext[j]),dist+=cpdist[j];len--;)c=buf32k[bIdx-dist&32767],addBuffer(c)}else addBuffer(j)}while(!last);return flushBuffer(),byteAlign(),0}function nextFile(){var i,c,extralen,filelen,size,compSize,crc,method,tmp=[];if(outputArr=[],modeZIP=!1,tmp[0]=readByte(),tmp[1]=readByte(),120===tmp[0]&&218===tmp[1]&&(deflateLoop(),unzipped[files]=[outputArr.join(""),"geonext.gxt"],files++),31===tmp[0]&&139===tmp[1]&&(skipdir(),unzipped[files]=[outputArr.join(""),"file"],files++),80===tmp[0]&&75===tmp[1]&&(modeZIP=!0,tmp[2]=readByte(),tmp[3]=readByte(),3===tmp[2]&&4===tmp[3])){for(tmp[0]=readByte(),tmp[1]=readByte(),gpflags=readByte(),gpflags|=readByte()<<8,method=readByte(),method|=readByte()<<8,readByte(),readByte(),readByte(),readByte(),crc=readByte(),crc|=readByte()<<8,crc|=readByte()<<16,crc|=readByte()<<24,compSize=readByte(),compSize|=readByte()<<8,compSize|=readByte()<<16,compSize|=readByte()<<24,size=readByte(),size|=readByte()<<8,size|=readByte()<<16,size|=readByte()<<24,filelen=readByte(),filelen|=readByte()<<8,extralen=readByte(),extralen|=readByte()<<8,i=0,nameBuf=[];filelen--;)c=readByte(),"/"===c|":"===c?i=0:i<JPAK.GZIP.NAMEMAX-1&&(nameBuf[i++]=String.fromCharCode(c));for(fileout||(fileout=nameBuf),i=0;extralen>i;)c=readByte(),i++;SIZE=0,8===method&&(deflateLoop(),unzipped[files]=new Array(2),unzipped[files][0]=outputArr.join(""),unzipped[files][1]=nameBuf.join(""),files++),skipdir()}}var gpflags,SIZE,fileout,flens,fmax,skipdir,outputArr=[],files=0,unzipped=[],buf32k=new Array(32768),bIdx=0,modeZIP=!1,barraylen=barray.length,bytepos=0,bb=1,bits=0,literalTree=new Array(288),distanceTree=new Array(32),treepos=0,Places=null,len=(new Array(64),new Array(64),0),fpos=new Array(17),nameBuf=[];fpos[0]=0,skipdir=function(){var crc,compSize,size,os,i,c,tmp=[];if(8&gpflags&&(tmp[0]=readByte(),tmp[1]=readByte(),tmp[2]=readByte(),tmp[3]=readByte(),80===tmp[0]&&75===tmp[1]&&7===tmp[2]&&8===tmp[3]?(crc=readByte(),crc|=readByte()<<8,crc|=readByte()<<16,crc|=readByte()<<24):crc=tmp[0]|tmp[1]<<8|tmp[2]<<16|tmp[3]<<24,compSize=readByte(),compSize|=readByte()<<8,compSize|=readByte()<<16,compSize|=readByte()<<24,size=readByte(),size|=readByte()<<8,size|=readByte()<<16,size|=readByte()<<24),modeZIP&&nextFile(),tmp[0]=readByte(),8===tmp[0]){if(gpflags=readByte(),readByte(),readByte(),readByte(),readByte(),readByte(),os=readByte(),4&gpflags)for(tmp[0]=readByte(),tmp[2]=readByte(),len=tmp[0]+256*tmp[1],i=0;len>i;i++)readByte();if(8&gpflags)for(i=0,nameBuf=[],c=readByte();c;)("7"===c||":"===c)&&(i=0),NAMEMAX-1>i&&(nameBuf[i++]=c),c=readByte();if(16&gpflags)for(c=readByte();c;)c=readByte();2&gpflags&&(readByte(),readByte()),deflateLoop(),crc=readByte(),crc|=readByte()<<8,crc|=readByte()<<16,crc|=readByte()<<24,size=readByte(),size|=readByte()<<8,size|=readByte()<<16,size|=readByte()<<24,modeZIP&&nextFile()}}},GZ.Unzip.prototype.unzipFile=function(name){this.unzip();for(var i=0;i<unzipped.length;i++)if(unzipped[i][1]===name)return unzipped[i][0];return""},GZ.Unzip.prototype.unzip=function(){return nextFile(),unzipped},JPAK.Tools.GZ=GZ}(),"undefined"!=typeof module&&"undefined"!=typeof module.exports?module.exports.JPAK=JPAK:window.JPAK=JPAK;